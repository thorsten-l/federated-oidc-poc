{"version":3,"file":"user_oidc-node_modules_nextcloud_dialogs_dist_chunks_PublicAuthPrompt-CmdyKTox_mjs.js?v=4d538fe2adab33dbc2ca","mappings":"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","sources":["webpack:///user_oidc/node_modules/@nextcloud/dialogs/node_modules/@nextcloud/browser-storage/dist/ScopedStorage.js","webpack:///user_oidc/node_modules/@nextcloud/dialogs/node_modules/@nextcloud/browser-storage/dist/StorageBuilder.js","webpack:///user_oidc/node_modules/@nextcloud/dialogs/dist/chunks/PublicAuthPrompt-CmdyKTox.mjs","webpack:///user_oidc/node_modules/@nextcloud/dialogs/node_modules/@nextcloud/browser-storage/dist/index.js"],"sourcesContent":["/*\n * SPDX-FileCopyrightText: 2020 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: GPL-3.0-or-later\n */\nexport default class ScopedStorage {\n    static GLOBAL_SCOPE_VOLATILE = 'nextcloud_vol';\n    static GLOBAL_SCOPE_PERSISTENT = 'nextcloud_per';\n    scope;\n    wrapped;\n    constructor(scope, wrapped, persistent) {\n        this.scope = `${persistent ? ScopedStorage.GLOBAL_SCOPE_PERSISTENT : ScopedStorage.GLOBAL_SCOPE_VOLATILE}_${btoa(scope)}_`;\n        this.wrapped = wrapped;\n    }\n    scopeKey(key) {\n        return `${this.scope}${key}`;\n    }\n    setItem(key, value) {\n        this.wrapped.setItem(this.scopeKey(key), value);\n    }\n    getItem(key) {\n        return this.wrapped.getItem(this.scopeKey(key));\n    }\n    removeItem(key) {\n        this.wrapped.removeItem(this.scopeKey(key));\n    }\n    clear() {\n        Object.keys(this.wrapped)\n            .filter((key) => key.startsWith(this.scope))\n            .map(this.wrapped.removeItem.bind(this.wrapped));\n    }\n}\n","/*\n * SPDX-FileCopyrightText: 2020 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: GPL-3.0-or-later\n */\nimport ScopedStorage from \"./ScopedStorage.js\";\nexport default class StorageBuilder {\n    appId;\n    persisted = false;\n    clearedOnLogout = false;\n    constructor(appId) {\n        this.appId = appId;\n    }\n    persist(persist = true) {\n        this.persisted = persist;\n        return this;\n    }\n    clearOnLogout(clear = true) {\n        this.clearedOnLogout = clear;\n        return this;\n    }\n    build() {\n        return new ScopedStorage(this.appId, this.persisted ? window.localStorage : window.sessionStorage, !this.clearedOnLogout);\n    }\n}\n","import { defineComponent, useTemplateRef, ref, watch, computed, createBlock, openBlock, unref, withCtx, createElementBlock, createCommentVNode, createVNode, toDisplayString } from \"vue\";\nimport { setGuestNickname } from \"@nextcloud/auth\";\nimport { getBuilder } from \"@nextcloud/browser-storage\";\nimport NcDialog from \"@nextcloud/vue/components/NcDialog\";\nimport NcNoteCard from \"@nextcloud/vue/components/NcNoteCard\";\nimport NcTextField from \"@nextcloud/vue/components/NcTextField\";\nimport { t, l as logger, s as showError } from \"./index-Dh8t1o6F.mjs\";\nimport { validateFilename, InvalidFilenameError, InvalidFilenameErrorReason } from \"@nextcloud/files\";\nimport { _ as _export_sfc } from \"./_plugin-vue_export-helper-1tPrXgE0.mjs\";\n/*!\n * SPDX-FileCopyrightText: 2024 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\nfunction getGuestNameValidity(name) {\n  if (name.trim() === \"\") {\n    return t(\"Names must not be empty.\");\n  }\n  if (name.startsWith(\".\")) {\n    return t(\"Names must not start with a dot.\");\n  }\n  if (name.length > 64) {\n    return t(\"Names may be at most 64 characters long.\");\n  }\n  try {\n    validateFilename(name);\n    return \"\";\n  } catch (error) {\n    if (!(error instanceof InvalidFilenameError)) {\n      throw error;\n    }\n    switch (error.reason) {\n      case InvalidFilenameErrorReason.Character:\n        return t('\"{char}\" is not allowed inside a name.', { char: error.segment });\n      case InvalidFilenameErrorReason.ReservedName:\n        return t('\"{segment}\" is a reserved name and not allowed.', { segment: error.segment });\n      case InvalidFilenameErrorReason.Extension:\n        if (error.segment.match(/\\.[a-z]/i)) {\n          return t('\"{extension}\" is not an allowed name.', { extension: error.segment });\n        }\n        return t('Names must not end with \"{extension}\".', { extension: error.segment });\n      default:\n        return t(\"Invalid name.\");\n    }\n  }\n}\nconst _hoisted_1 = {\n  key: 0,\n  class: \"public-auth-prompt__text\"\n};\nconst _sfc_main = /* @__PURE__ */ defineComponent({\n  __name: \"PublicAuthPrompt\",\n  props: {\n    nickname: { default: \"\" },\n    title: { default: t(\"Guest identification\") },\n    text: { default: \"\" },\n    notice: { default: \"\" },\n    submitLabel: { default: t(\"Submit name\") },\n    cancellable: { type: Boolean }\n  },\n  emits: [\"close\"],\n  setup(__props, { emit: __emit }) {\n    const props = __props;\n    const emit = __emit;\n    const inputElement = useTemplateRef(\"input\");\n    const storage = getBuilder(\"public\").build();\n    const name = ref(props.nickname);\n    watch(() => props.nickname, () => {\n      name.value = props.nickname;\n    });\n    watch(name, (newName) => {\n      const validity = getGuestNameValidity(newName);\n      if (!validity) {\n        inputElement.value.setCustomValidity(validity);\n        inputElement.value.reportValidity();\n        inputElement.value.focus();\n        return;\n      }\n    });\n    const buttons = computed(() => {\n      const cancelButton = {\n        label: t(\"Cancel\"),\n        variant: \"tertiary\",\n        callback: () => emit(\"close\")\n      };\n      const submitButton = {\n        label: props.submitLabel,\n        type: \"submit\",\n        variant: \"primary\"\n      };\n      if (props.cancellable) {\n        return [cancelButton, submitButton];\n      }\n      return [submitButton];\n    });\n    const defaultNotice = computed(() => {\n      if (props.notice) {\n        return props.notice;\n      }\n      if (name.value) {\n        return t(\"You are currently identified as {nickname}.\", { nickname: name.value });\n      }\n      return t(\"You are currently not identified.\");\n    });\n    function onSubmit() {\n      const nickname = name.value.trim();\n      const validity = getGuestNameValidity(nickname);\n      if (validity) {\n        inputElement.value.setCustomValidity(validity);\n        inputElement.value.reportValidity();\n        inputElement.value.focus();\n        return;\n      }\n      if (nickname === \"\") {\n        inputElement.value.setCustomValidity(t(\"You cannot leave the name empty.\"));\n        inputElement.value.reportValidity();\n        inputElement.value.focus();\n        return;\n      }\n      if (nickname.length < 2) {\n        inputElement.value.setCustomValidity(t(\"Please enter a name with at least 2 characters.\"));\n        inputElement.value.reportValidity();\n        inputElement.value.focus();\n        return;\n      }\n      try {\n        setGuestNickname(nickname);\n      } catch (error) {\n        logger.error(\"Failed to set nickname\", { error });\n        showError(t(\"Failed to set nickname.\"));\n        inputElement.value.focus();\n        return;\n      }\n      storage.setItem(\"public-auth-prompt-shown\", \"true\");\n      emit(\"close\", name.value);\n    }\n    return (_ctx, _cache) => {\n      return openBlock(), createBlock(unref(NcDialog), {\n        buttons: buttons.value,\n        class: \"public-auth-prompt\",\n        \"data-cy-public-auth-prompt-dialog\": \"\",\n        \"is-form\": \"\",\n        \"no-close\": \"\",\n        name: __props.title,\n        onSubmit\n      }, {\n        default: withCtx(() => [\n          __props.text ? (openBlock(), createElementBlock(\"p\", _hoisted_1, toDisplayString(__props.text), 1)) : createCommentVNode(\"\", true),\n          createVNode(unref(NcNoteCard), {\n            class: \"public-auth-prompt__header\",\n            text: defaultNotice.value,\n            type: \"info\"\n          }, null, 8, [\"text\"]),\n          createVNode(unref(NcTextField), {\n            ref: \"input\",\n            modelValue: name.value,\n            \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event) => name.value = $event),\n            class: \"public-auth-prompt__input\",\n            \"data-cy-public-auth-prompt-dialog-name\": \"\",\n            label: unref(t)(\"Name\"),\n            placeholder: unref(t)(\"Enter your name\"),\n            required: !__props.cancellable,\n            minlength: \"2\",\n            maxlength: \"64\",\n            name: \"name\"\n          }, null, 8, [\"modelValue\", \"label\", \"placeholder\", \"required\"])\n        ]),\n        _: 1\n      }, 8, [\"buttons\", \"name\"]);\n    };\n  }\n});\nconst PublicAuthPrompt = /* @__PURE__ */ _export_sfc(_sfc_main, [[\"__scopeId\", \"data-v-b33d88e5\"]]);\nexport {\n  PublicAuthPrompt as default\n};\n//# sourceMappingURL=PublicAuthPrompt-CmdyKTox.mjs.map\n","/*\n * SPDX-FileCopyrightText: 2020 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: GPL-3.0-or-later\n */\nimport ScopedStorage from \"./ScopedStorage.js\";\nimport StorageBuilder from \"./StorageBuilder.js\";\n/**\n * Get the storage builder for an app\n *\n * @param appId App ID to scope storage\n */\nexport function getBuilder(appId) {\n    return new StorageBuilder(appId);\n}\n/**\n * Clear values from storage\n *\n * @param storage The storage to clear\n * @param pred Callback to check if value should be cleared\n */\nfunction clearStorage(storage, pred) {\n    Object.keys(storage)\n        .filter((k) => pred ? pred(k) : true)\n        .map(storage.removeItem.bind(storage));\n}\n/**\n * Clear all values from all storages\n */\nexport function clearAll() {\n    const storages = [\n        window.sessionStorage,\n        window.localStorage,\n    ];\n    storages.map((s) => clearStorage(s));\n}\n/**\n * Clear ony non persistent values\n */\nexport function clearNonPersistent() {\n    const storages = [\n        window.sessionStorage,\n        window.localStorage,\n    ];\n    storages.map((s) => clearStorage(s, (k) => !k.startsWith(ScopedStorage.GLOBAL_SCOPE_PERSISTENT)));\n}\n"],"names":["static","scope","wrapped","constructor","persistent","this","GLOBAL_SCOPE_PERSISTENT","GLOBAL_SCOPE_VOLATILE","btoa","scopeKey","key","setItem","value","getItem","removeItem","clear","Object","keys","filter","startsWith","map","bind","StorageBuilder","appId","persisted","clearedOnLogout","persist","clearOnLogout","build","window","localStorage","sessionStorage","getGuestNameValidity","name","trim","t","length","error","reason","Character","char","segment","ReservedName","Extension","match","extension","_hoisted_1","class","_sfc_main","__name","props","nickname","default","title","text","notice","submitLabel","cancellable","type","Boolean","emits","setup","__props","emit","__emit","inputElement","storage","newName","validity","setCustomValidity","reportValidity","focus","buttons","cancelButton","label","variant","callback","submitButton","defaultNotice","onSubmit","l","s","_ctx","_cache","NcDialog","NcNoteCard","NcTextField","ref","modelValue","$event","placeholder","required","minlength","maxlength","_","PublicAuthPrompt"],"sourceRoot":""}